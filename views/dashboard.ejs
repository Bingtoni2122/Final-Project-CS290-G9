<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Schedule Manager</title>
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Ensure placeholder has a sensible min-height without injecting styles from EJS */
        .placeholder-min { min-height: 150px; }
    </style>
</head>
<body>

<div class="schedule-container">

        <header class="schedule-header">
            <h1>Student Schedule</h1>
            <p class="subtitle">Combine your work schedule from W2W and class timetable from OSU in one place</p>
            <div class="actions">
                <%# ğŸŒŸ ä¿®æ”¹ 1: å°‡ Add Event æŒ‰éˆ•ç›´æ¥ç¶å®šåˆ° JS å‡½æ•¸ ğŸŒŸ %>
                <button class="add-event" onclick="openAddEventModal()"><i class="icon">+</i> Add Event</button>
                <button class="import-schedule" onclick="openImportModal()"><i class="icon">â†‘</i> Import Schedule</button>
            </div>
            <div class="tabs" id="filterTabs">
                <a href="/" class="tab <%= eventType === '' ? 'active' : '' %>" data-type="all">
                    All Events (<%= allEventCount %>)
                </a>
                
                <a href="/works" class="tab <%= eventType === 'works' ? 'active' : '' %>" data-type="work">
                    Work Shifts (<%= workEventCount %>)
                </a>
                
                <a href="/classes" class="tab <%= eventType === 'classes' ? 'active' : '' %>" data-type="class">
                    Classes (<%= classEventCount %>)
                </a>
            </div>
        </header>

        <div class="schedule-grid">
            <% 
                const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            %>

            <% daysOfWeek.forEach(day => { %>
                <div class="day-column">
                    <h2 class="day-title"><%= day %></h2>

                    <% 
                        const dayEvents = eventsByDay[day] || [];
                    %>

                        <% if (dayEvents.length === 0) { %>
                            <%# ğŸŒŸ ç¢ºä¿ä½¿ç”¨ placeholder-min é¡åˆ¥ä¾†è¨­å®šæœ€å°é«˜åº¦ ğŸŒŸ %>
                            <div class="placeholder-card placeholder-min">
                                <p class="no-events-text">No schedule</p>
                            </div>
                    <% } else { %>
                        <% dayEvents.forEach(event => { %>
                            <% if (event.type === 'work') { %>
                                <%- include('work_event_card', { event: event }) %>
                            <% } else if (event.type === 'class') { %>
                                <%- include('class_event_card', { event: event }) %>
                            <% } %>
                        <% }); %>
                    <% } %>
                </div>
            <% }); %>

        </div>

    </div>

    <%# å¼•å…¥ import_schedule æ¨¡æ¿ (Modal) %>
    <%- include('import_schedule') %>

    <%# ğŸŒŸ ä¿®æ”¹ 2: å¼•å…¥æ–°çš„ add_event æ¨¡æ¿ (Modal) ğŸŒŸ %>
    <%- include('add_event') %>

    <%# ğŸŒŸ ä¿®æ”¹ 3: æ–°å¢ JavaScript é‚è¼¯ ğŸŒŸ %>
    <script>
        // --- Add Event Modal æ§åˆ¶å‡½æ•¸ ---
        
        function openAddEventModal() {
            document.getElementById('addEventModal').style.display = 'flex';
        }

        function closeAddEventModal() {
            document.getElementById('addEventModal').style.display = 'none';
            // å¯é¸ï¼šé‡ç½®è¡¨å–®
            document.getElementById('addEventForm').reset();
        }

        // --- Import Modal æ§åˆ¶å‡½æ•¸ (å‡è¨­æ‚¨åœ¨ import_schedule.ejs ä¸­ä½¿ç”¨ importModal) ---
        // (ä¿æŒèˆ‡æ‚¨çš„ openImportModal() ç›¸ç¬¦çš„é‚è¼¯ï¼Œé€™è£¡æä¾›ä¸€å€‹ç¯„ä¾‹)
        function openImportModal() {
            document.getElementById('importModal').style.display = 'flex';
            // é è¨­é¸æ“‡ W2W Tab (å‡è¨­ tab çš„ id æ˜¯ 'w2w-tab' å’Œ 'osu-tab')
            // switchImportTab('w2w'); 
        }

        function closeImportModal() {
            document.getElementById('importModal').style.display = 'none';
        }

        // --- è¡¨å–®æäº¤é‚è¼¯ ---
        document.getElementById('addEventForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // å¯¦éš›æ‡‰è©²æ˜¯å°‡æ•¸æ“šç™¼é€åˆ°å¾Œç«¯ server.js çš„ /add-event è·¯ç”±
            console.log('Submitting new event data...');
            
            // å‡è¨­æäº¤æˆåŠŸï¼Œé—œé–‰æ¨¡æ…‹æ¡†
            closeAddEventModal();
            // åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œæ‚¨æœƒåœ¨é€™è£¡ç™¼é€ AJAX/Fetch è«‹æ±‚
            // window.location.reload(); 
        });
    </script>
</body>
</html>
